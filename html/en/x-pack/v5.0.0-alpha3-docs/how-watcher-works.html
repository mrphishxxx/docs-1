<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>How Watcher Works
        | X-Pack for the Elastic Stack
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="X-Pack for the Elastic Stack" /><link rel="up" href="xpack-alerting.html" title="Watcher - Alerting &amp; Notification" /><link rel="prev" href="customizing-actions.html" title="Customizing Actions" /><link rel="next" href="administering-watcher.html" title="Administering Watcher" /><meta name="DC.type" content="Docs/XPack/Reference" /><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png?change=123"><link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png?change=123"><link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png?change=123"><link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png?change=123"><link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png?change=123"><link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png?change=123"><link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png?change=123"><link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png?change=123"><link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png?change=123"><link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png?change=123"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?change=123"><link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png?change=123"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?change=123"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"><meta name="description" content=""/><meta property="og:image" content="/static/img/cluster-small.png"/><link rel="shortcut icon" href="favicon.ico" type="image/x-icon"><link rel="icon" href="favicon.ico?change=123" type="image/x-icon"><link rel="apple-touch-icon-precomposed" sizes="64x64" href="favicon_64x64_16bit.png"><link rel="apple-touch-icon-precomposed" sizes="32x32" href="favicon_32x32.png"><link rel="apple-touch-icon-precomposed" sizes="16x16" href="favicon_16x16.png"><link href="/static/css/main.css" rel="stylesheet"> <!--[if lt IE 9]><script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script><script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]--><link type="text/css" rel="stylesheet" href="/static/css/prettify.css"/><link type="text/css" rel="stylesheet" href="/static/css/guide.css"/><script type="text/javascript" src="/static/js/prettify.js"></script>
<link rel="stylesheet" type="text/css" href="styles.css" />

</head><body><script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-58RLH5');</script><header class="header-wrapper"><div class="navigation-wrapper"><div class="container"><nav class="navbar"><div class="navbar-mobile-header navbar-header mr-20 mr-xs-0"><div class="row hidden-sm hidden-md hidden-lg"><div class="col-xs-5 hidden-sm hidden-md hidden-lg"><div class="navbar-mobile-header-icon navbar-mobile-header-icon-out"><span></span><span></span><span></span></div> <a href="/learn" class="nav-title hidden-sm hidden-md hidden-lg m-l-10">Learn</a></div><div class="col-xs-2 text-center"><div class="navbar-brand" id="elastic"><h1> <a class="logo-m hidden-sm hidden-md hidden-lg" href="/"><img src="/assets/blt65c71c1236219a27/elastic-logo-mobile.svg" alt="elastic-logo-mobile"></a></h1></div></div><div class="col-xs-5 hidden-sm hidden-md hidden-lg text-right"><ul class="menu-m hidden-sm hidden-md hidden-lg"><li class=""><a class="icon-contact" href="/contact"></a></li><li id="searchbar"><a class="button icon" href="#"></a></li><li class="lang global-language"><a href="#">EN</a><ul class="language-list"><li><a href="/">English</a></li><li><a href="/fr/">français</a></li><li><a href="/de/">Deutsche</a></li><li><a href="/jp/">日本語</a></li><li><a href="/kr/">한국어</a></li></ul></li></ul></div></div><div class="navbar-brand hidden-xs" id="elastic"><h1> <a class="hidden-xs" id="elastic-logo" href="/"><img src="/assets/blt49aa5273c3bf983b/elastic-logo.svg" alt="elastic-logo"></a></h1></div></div><div class="collapse navbar-collapse mobile-inner-nav"><nav class="nav navbar-nav primary-nav-hover" id="nav"><ul><li> <a id="nav_products" class="  nav-item" href="/products">Products</a><div class="text-center quaternary-nav hidden-xs hover-nav"><div class="container"><div class="p-t-b-5"><ul class="list-inline nav-group"><li> <a href="/products/elasticsearch">Elasticsearch</a></li><li> <a href="/cloud">Elasticsearch as a Service</a></li><li> <a href="/products/logstash">Logstash</a></li><li> <a href="/products/kibana">Kibana</a></li><li> <a href="/products/beats">Beats</a></li><li> <a href="/products/watcher">Watcher</a></li><li> <a href="/products/shield">Shield</a></li><li> <a href="/products/marvel">Marvel</a></li><li> <a href="/products/graph">Graph</a></li><li> <a href="/products/reporting">Reporting</a></li><li> <a href="/products/hadoop">Hadoop</a></li></ul></div></div></div><ul class="hidden-sm hidden-md hidden-lg sub-navigation"><li><a id="nav_elasticsearch" href="/products/elasticsearch">Elasticsearch</a></li><li><a id="nav_elasticsearch as a service" href="/cloud">Elasticsearch as a Service</a></li><li><a id="nav_logstash" href="/products/logstash">Logstash</a></li><li><a id="nav_kibana" href="/products/kibana">Kibana</a></li><li><a id="nav_beats" href="/products/beats">Beats</a></li><li><a id="nav_watcher" href="/products/watcher">Watcher</a></li><li><a id="nav_shield" href="/products/shield">Shield</a></li><li><a id="nav_marvel" href="/products/marvel">Marvel</a></li><li><a id="nav_graph" href="/products/graph">Graph</a></li><li><a id="nav_reporting" href="/products/reporting">Reporting</a></li><li><a id="nav_hadoop" href="/products/hadoop">Hadoop</a></li></ul></li><li> <a id="nav_cloud" class="  nav-item" href="/cloud">Cloud</a><div class="text-center quaternary-nav hidden-xs hover-nav"><div class="container"><div class="p-t-b-5"><ul class="list-inline nav-group"><li> <a href="/cloud/subscriptions">Subscriptions</a></li><li> <a href="/cloud/pricing">Pricing</a></li><li> <a href="/cloud/support">Support</a></li></ul></div></div></div><ul class="hidden-sm hidden-md hidden-lg sub-navigation"><li><a id="nav_subscriptions" href="/cloud/subscriptions">Subscriptions</a></li><li><a id="nav_pricing" href="/cloud/pricing">Pricing</a></li><li><a id="nav_support" href="/cloud/support">Support</a></li></ul></li><li> <a id="nav_services" class="  nav-item" href="/services">Services</a></li><li> <a id="nav_customers" class="  nav-item" href="/use-cases">Customers</a></li><li> <a id="nav_learn" class="active nav-item" href="/learn">Learn</a><div class="text-center quaternary-nav hidden-xs hover-nav"><div class="container"><div class="p-t-b-5"><ul class="list-inline nav-group"><li> <a href="/community">Community</a></li><li> <a href="/guide">Docs</a></li><li> <a href="/blog">Blog</a></li><li> <a href="/videos">Videos</a></li><li> <a href="https://discuss.elastic.co/">Forums</a></li><li> <a href="/elasticon">Elastic{ON}</a></li></ul></div></div></div><ul class="hidden-sm hidden-md hidden-lg sub-navigation"><li><a id="nav_community" href="/community">Community</a></li><li><a id="nav_docs" href="/guide">Docs</a></li><li><a id="nav_blog" href="/blog">Blog</a></li><li><a id="nav_videos" href="/videos">Videos</a></li><li><a id="nav_forums" href="https://discuss.elastic.co/">Forums</a></li><li><a id="nav_elastic{on}" href="/elasticon">Elastic{ON}</a></li></ul></li></ul></nav><nav class="nav navbar-nav navbar-right hidden-xs"><ul><li class="hidden-xs hidden-sm"><a href="/downloads">Downloads</a></li><li class="hidden-xs hidden-md hidden-lg"><a class="icon-download" href="/downloads"></a></li><li class="hidden-xs hidden-sm"><a class="btn btn-primary btn-contact" href="/contact">Contact</a></li><li class="hidden-xs hidden-md hidden-lg"><a class="icon-contact" href="/contact"></a></li><li class="hidden-xs" id="searchbar"><a class="button icon" href="#"></a></li><li class="hidden-xs lang global-language"><a href="#">EN</a><ul class="language-list"><li><a class="" href="/">English</a></li><li><a class="" href="/fr/">français</a></li><li><a class="" href="/de/">Deutsche</a></li><li><a class="" href="/jp/">日本語</a></li><li><a class="" href="/kr/">한국어</a></li></ul></li></ul></nav></div></nav></div></div><div class="header-search-wrapper open-search"><div class="container"><div class="big-search"><i class="big-search-icon"></i><form id="searchfrm" name="searchForm" autocomplete="on" action="/search" method="get"><ul class="tags-wrapper"><li class="search-field"><input type="text" name="q" id="autocomplete" class="form-control global-input" autocomplete="off"></li></ul></form><a class="header-search-cancel" href="#"></a></div><div class="nav-auto-complete"></div></div></div><script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script>
$(window).load(function () {
  $(".navbar-mobile-header-icon").click(function(index){
    $('.navigation-wrapper').toggleClass('menu-overlay');
    $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
    $(".mobile-inner-nav").slideToggle(500);
    $('.mobile-inner-nav .sub-navigation').css('display','none');
    $(".mobile-inner-nav a").each(function( index ) {
      $(this).css({'animation-delay': (index/25)+'s'});
    });
  });

  if($(window).width() < 769){
    $(".nav-item").click(function(e){
      e.preventDefault();
      var parent = $(this).parent();
      $('.sub-navigation',parent).slideToggle(250);
    })
  }
});
</script></header><style> 
    
      .m-shortcuts li a.m-search {
        background: url("/assets/blt78ef101d1c58b693/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-docs {
        background: url("/assets/blt8c2d02cd42735ac3/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-contact {
        background: url("/assets/blte4c9f7f37cf09587/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
      
</style><script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script type="text/javascript" src="/static/js/nav-v5.js"></script><script type="text/javascript">
  $(document).ready( function(){
    $('.navbar-toggle').on('click', function(){
      $('.mobile-navigation, .menu-open').hide();
      $('.navigation-wrapper').addClass('mobile-navigation');
      $('.navbar').addClass('menu-open');
      $('.menu-close').show();
    });
    $('.menu-close').on('click', function(){
      $('.navigation-wrapper').removeClass('mobile-navigation');
      $('.navbar').removeClass('menu-open');
      $('.menu-close').hide();
      console.log("close");
    });

    // $(".mobile-inner-header-icon").click(function(){
    //   $(this).toggleClass("mobile-inner-header-icon-click mobile-inner-header-icon-out");
    //   $(".mobile-inner-nav").slideToggle(250);
    //   $(".navigation-wrapper").toggleClass('mobile-menu');
    //   if ($('.mobile-inner-header-icon-click').is(":visible")) {
    //     $('.menu-m').css({'display':"none"});
    //   }else{
    //     $('.menu-m').css({'display':"table-cell"});
    //   }
    // });
    // $(".mobile-inner-nav a").each(function( index ) {
    //   $( this ).css({'animation-delay': (index/10)+'s'});
    //   // $(".navigation-wrapper").removeClass('mobile-menu');
    // });
  });
</script><div class="tertiary-nav"><div class="container"><div class="p-t-b-13 bdr-btm-e7e7e7 clearfix"><div class="breadcrum-wrapper pull-left text-left"> <a href="/learn">Learn</a> <span>Docs</span></div></div></div></div><div class="nav-mobile-dropdown hidden-sm hidden-md hidden-lg clearfix"><div class="container"><div class="breadcrum-wrapper pull-left text-left"> <a class="dropdown-btn" href="javascript:void(0)">Docs</a></div></div></div><div class="main-container"><section id="content"><div class="content-wrapper">
            <div id="pageheader">
    <div class="container">
        <header>
            <h1><a href="/learn" title="Learn">Learn</a> |</h1>
            <h2><a href="/guide" title="Docs">Docs</a></h2>
        </header>
    </div>
</div>
<section id="guide">

            <!-- start body -->
<div class="page_header"><b>PLEASE NOTE:</b> These docs are for a pre-GA version of X-Pack, 5.0.0-alpha3.</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">X-Pack for the Elastic Stack</a></span> » <span class="breadcrumb-link"><a href="xpack-alerting.html">Watcher - Alerting &amp; Notification </a></span> » <span class="breadcrumb-node">How Watcher Works</span></div><div class="navheader"><span class="prev"><a href="customizing-actions.html">
              « 
              Customizing Actions</a>
           
        </span><span class="next">
           
          <a href="administering-watcher.html">Administering Watcher
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="how-watcher-works"></a>How Watcher Works</h2></div></div></div><p>You <a class="link" href="how-watcher-works.html#watch-definition" title="Watch Definition">add watches</a> to automatically perform an action when
certain conditions are met. The conditions are generally based on data you’ve
loaded into the watch, also known as the <span class="emphasis"><em>Watch Payload</em></span>. This payload can be
loaded from different sources - from Elasticsearch, an external HTTP service, or
even a combination of the two.</p><p>For example, a watch can be configured to send an email to the sysadmin when a
search in the logs data indicates that there are too many 503 errors in the last
5 minutes.</p><p>This topic describes the elements of a watch and how watches operate.</p><h3><a id="watch-definition"></a>Watch Definition</h3><p>A watch consists of a <span class="emphasis"><em>trigger</em></span>, <span class="emphasis"><em>input</em></span>, <span class="emphasis"><em>condition</em></span>, and <span class="emphasis"><em>actions</em></span>. The actions
define what needs to be done once the condition is met. In addition, you can
define <span class="emphasis"><em>transforms</em></span> to process and prepare the watch payload before executing
the actions.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<a class="link" href="trigger.html" title="Triggers">Trigger</a>
</span></dt><dd>
Determines when the watch is checked. A watch must have a trigger.
</dd><dt><span class="term">
<a class="link" href="input.html" title="Inputs">Input</a>
</span></dt><dd>
Loads data into the watch payload. If no input is specified, an empty payload is
loaded.
</dd><dt><span class="term">
<a class="link" href="condition.html" title="Conditions">Condition</a>
</span></dt><dd>
Controls whether the watch actions are executed. If no condition is specified,
the condition defaults to <code class="literal">always</code>.
</dd><dt><span class="term">
<a class="link" href="transform.html" title="Transforms">Transform</a>
</span></dt><dd>
Processes the watch payload to prepare it for the watch actions. You can define
transforms at the watch level or define action-specific transforms. Optional.
</dd><dt><span class="term">
<a class="link" href="actions.html" title="Actions">Actions</a>
</span></dt><dd>
Specify what happens when the watch condition is met.
</dd></dl></div><p><a id="watch-definition-example"></a>For example, the following snippet shows a <a class="link" href="watcher-api-put-watch.html" title="Put Watch API">Put Watch</a>
request that defines a watch that looks for log error events:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT _xpack/watcher/watch/log_errors
{
  "metadata" : { <a id="CO37-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    "color" : "red"
  },
  "trigger" : { <a id="CO37-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
    "schedule" : {
      "interval" : "5m"
    }
  },
  "input" : { <a id="CO37-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
    "search" : {
      "request" : {
        "indices" : "log-events",
        "body" : {
          "size" : 0,
          "query" : { "match" : { "status" : "error" } }
        }
      }
    }
  },
  "condition" : { <a id="CO37-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
    "script" : "return ctx.payload.hits.total &gt; 5"
  },
  "transform" : { <a id="CO37-5"></a><span><img src="images/icons/callouts/5.png" alt="" /></span>
    "search" : {
        "request" : {
          "indices" : "log-events",
          "body" : {
            "query" : { "match" : { "status" : "error" } }
          }
        }
    }
  },
  "actions" : { <a id="CO37-6"></a><span><img src="images/icons/callouts/6.png" alt="" /></span>
    "my_webhook" : {
      "webhook" : {
        "method" : "POST",
        "host" : "mylisteninghost",
        "port" : 9200,
        "path" : "/{{watch_id}}",
        "body" : "Encountered {{ctx.payload.hits.total}} errors"
      }
    },
    "email_administrator" : {
      "email" : {
        "to" : "sys.admino@host.domain",
        "subject" : "Encountered {{ctx.payload.hits.total}} errors",
        "body" : "Too many error in the system, see attached data",
        "attachments" : {
          "attached_data" : {
            "data" : {
              "format" : "json"
            }
          }
        },
        "priority" : "high"
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/how-watcher-works/1.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO37-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Metadata  - You can attach optional static metadata to a watch.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO37-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Trigger   - This schedule trigger executes the watch every 5 minutes.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO37-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Input     - This input searches for errors in the <code class="literal">log-events</code> index and
                loads the response into the watch payload.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO37-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Condition - This condition checks to see if there are more than 5 error
                events (hits in the search response). If there are, execution
                continues.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO37-5"><span><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Transform - If the watch condition is met, this transform loads all of the
                errors into the watch payload by searching for the errors using
                the default search type, <code class="literal">query_then_fetch</code>. All of the watch
                actions have access to this payload.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO37-6"><span><img src="images/icons/callouts/6.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Actions   - This watch has two actions. The <code class="literal">my_webhook</code> action notifies a
                3rd party system about the problem. The <code class="literal">email_administrator</code>
                action sends a high priority email to the system administrator.
                The watch payload that contains the errors is attached to the
                email.
</p></td></tr></table></div><h3><a id="watch-execution"></a>Watch Execution</h3><p>When you add a watch, Watcher immediately registers its trigger with the
appropriate trigger engine. Watches that have a <code class="literal">schedule</code> trigger are registered
with the <code class="literal">scheduler</code> trigger engine. The trigger engine is responsible for
triggering the execution of the watch. Trigger engines run on the master node
and use a separate thread pool from the one used to execute watches.</p><p>When a watch is triggered, Watcher queues it up for execution. A <code class="literal">watch_record</code>
document is created and added to the watch history and
its initial status is set to <code class="literal">awaits_execution</code>.</p><p>When execution starts, Watcher creates a watch execution context for the watch.
The execution context provides scripts and templates access to the watch metadata,
payload, watch ID, execution time, and trigger information. For more information,
see <a class="link" href="how-watcher-works.html#watch-execution-context" title="Watch Execution Context">Watch Execution Context</a>.</p><p>During the execution process, Watcher:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Loads the input data as the payload in the watch execution context. This makes
  the data available to all subsequent steps in the execution process. This step
  is controlled by the input of the watch.
</li><li class="listitem">
Evaluates the watch condition to determine whether or not to continue processing
  the watch. If the condition is met (evaluates to <code class="literal">true</code>), processing advances
  to the next step. If it is not met (evaluates to <code class="literal">false</code>), execution of the watch
  stops.
</li><li class="listitem">
Applies transforms to the watch payload (if needed).
</li><li class="listitem">
Executes the watch actions granted the condition is met and the watch is not
  <a class="link" href="how-watcher-works.html#watch-acknowledgment-throttling" title="Watch Acknowledgment and Throttling">throttled</a>.
</li></ol></div><p>When the watch execution finishes, the execution result is recorded as a
<span class="emphasis"><em>Watch Record</em></span> in the watch history. The watch record includes the execution
time and duration, whether the watch condition was met, and the status of each
action that was executed.</p><p>The following diagram shows the watch execution process:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="images/watcher/watch-execution.jpg" align="middle" alt="watch-execution.jpg" /></div></div><h3><a id="watch-acknowledgment-throttling"></a>Watch Acknowledgment and Throttling</h3><p>Watcher supports both time-based and acknowledgment-based throttling. This
enables you to prevent actions from being repeatedly executed for the same event.</p><p>By default, Watcher uses time-based throttling with a throttle period of 5
seconds. This means that if a watch is executed every second, its actions are
performed a maximum of once every 5 seconds, even when the condition is always
met. You can configure the throttle period on a per-action basis or at the
watch level.</p><p>Acknowledgment-based throttling enables you to tell Watcher not to send any more
notifications about a watch as long as its condition is met. Once the condition
evaluates to <code class="literal">false</code>, the acknowledgment is cleared and Watcher resumes executing
the watch actions normally.</p><p>For more information, see <a class="xref" href="actions.html#actions-ack-throttle" title="Acknowledgement and Throttling">Acknowledgement and Throttling</a>.</p><h3><a id="watch-active-state"></a>Watch Active State</h3><p>By default, when you add a watch it is immediately set to the <span class="emphasis"><em>active</em></span> state. An
active watch is registered with the relevant trigger engine and executed according
to its configured trigger. For example, if a watch has a <a class="link" href="trigger.html#trigger-schedule" title="Schedule Trigger"><code class="literal">schedule</code></a>
trigger, it is executed according to its schedule.</p><p>A watch can also be set to an <span class="emphasis"><em>inactive</em></span> state. An inactive watch is still
registered with Watcher, but it is not registered with a trigger engine and
therefore can never be triggered.</p><p>When you add a watch, you can use the <a class="link" href="watcher-api-put-watch.html#watcher-api-put-watch-active-state" title="Controlling Default Active State"><code class="literal">active</code></a>
parameter to set its initial state to <span class="emphasis"><em>inactive</em></span>. You can deactivate an existing
watch with the <a class="link" href="watcher-api-deactivate-watch.html" title="Deactivate Watch API">Deactivate Watch API</a>, and use the
<a class="link" href="watcher-api-activate-watch.html" title="Activate Watch API">Activate Watch API</a> to reactivate it.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>You can still use the <a class="link" href="watcher-api-execute-watch.html" title="Execute Watch API">Execute Watch API</a> to
        force the execution of an inactive watch.</p></div></div><p>Deactivating watches is useful in a variety of situations. For example, if you
have a watch that monitors an external system and you need to take that system
down for maintenance, you can deactivate the watch to prevent it from falsely
reporting availability issues during the maintenance window.</p><p>Deactivating a watch also enables you to keep it around for future use without
deleting it from the system.</p><h3><a id="scripts-templates"></a>Scripts and Templates</h3><p>You can use scripts and templates when defining a watch. Scripts and templates
can reference elements in the watch execution context, including the watch payload.
The execution context defines variables you can use in a script and parameter
placeholders in a template.</p><p>Watcher uses the Elasticsearch script infrastructure, which supports
<a class="link" href="how-watcher-works.html#inline-templates-scripts" title="Inline Templates and Scripts">inline</a>, <a class="link" href="how-watcher-works.html#stored-templates-scripts" title="Stored Templates and Scripts">stored</a>, and
<a class="link" href="how-watcher-works.html#file-templates-scripts" title="File-based Templates and Scripts">file-based scripts</a>. Scripts and templates are compiled
and cached by Elasticsearch to optimize recurring execution.
<a class="ulink" href="http://www.elastic.co/guide/en/elasticsearch/reference/master/modules-scripting-using.html#reload-scripts" target="_top">Autoloading</a> is also
supported. For more information, see <a class="ulink" href="http://www.elastic.co/guide/en/elasticsearch/reference/master/modules-scripting.html" target="_top">Scripting</a>
in the Elasticsearch Reference.</p><h4><a id="watch-execution-context"></a>Watch Execution Context</h4><p>The following snippet shows the basic structure of the <span class="emphasis"><em>Watch Execution Context</em></span>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "ctx" : {
    "metadata" : { ... }, <a id="CO38-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    "payload" : { ... }, <a id="CO38-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
    "watch_id" : "&lt;id&gt;", <a id="CO38-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
    "execution_time" : "20150220T00:00:10Z", <a id="CO38-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
    "trigger" : { <a id="CO38-5"></a><span><img src="images/icons/callouts/5.png" alt="" /></span>
      "triggered_time" : "20150220T00:00:10Z",
      "scheduled_time" : "20150220T00:00:00Z"
    },
    "vars" : { ... } <a id="CO38-6"></a><span><img src="images/icons/callouts/6.png" alt="" /></span>
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO38-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Any static metadata specified in the watch definition.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO38-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The current watch payload.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO38-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The id of the executing watch.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO38-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
A timestamp that shows when the watch execution started.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO38-5"><span><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Information about the trigger event. For a <code class="literal">schedule</code> trigger, this
    consists of the <code class="literal">triggered_time</code> (when the watch was triggered)
    and the <code class="literal">scheduled_time</code> (when the watch was scheduled to be triggered).
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO38-6"><span><img src="images/icons/callouts/6.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Dynamic variables that can be set and accessed by different constructs
    during the execution. These variables are scoped to a single execution
    (i.e they’re not persisted and can’t be used between different executions
    of the same watch)
</p></td></tr></table></div><h4><a id="scripts"></a>Using Scripts</h4><p>You can use scripts to define <a class="link" href="condition.html#condition-script" title="Script Condition">conditions</a> and
<a class="link" href="transform.html#transform-script" title="Script Transform">transforms</a>. The default scripting language is groovy.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Starting with 5.0, Elasticsearch is shipped with the new
      <a class="ulink" href="http://www.elastic.co/guide/en/elasticsearch/reference/master/modules-scripting-painless.html" target="_top">Painless</a> scripting language.
      Painless was created and designed specifically for use in Elasticsearch.
      Beyond providing an extensive feature set, its biggest trait is that it’s
      properly sandboxed and safe to use anywhere in the system (including in
      Watcher) without the need to enable dynamic scripting.</p></div></div><p>Scripts can reference any of the values in the watch execution context or values
explicitly passed through script parameters.</p><p>For example, if the watch metadata contains a <code class="literal">color</code> field
(e.g. <code class="literal">"metadata" : {"color": "red"}</code>), you can access its value with the via the
<code class="literal">ctx.metadata.color</code> variable. If you pass in a <code class="literal">color</code>  parameter as part of the
condition or transform definition (e.g. <code class="literal">"params" : {"color": "red"}</code>), you can
access its value via the <code class="literal">color</code> variable.</p><h4><a id="templates"></a>Using Templates</h4><p>You use templates to define dynamic content for a watch. At execution time,
templates pull in data from the watch execution context. For example, you can use
a template to populate the <code class="literal">subject</code> field for an <code class="literal">email</code> action with data stored
in the watch payload. Templates can also access values explicitly passed through
template parameters.</p><p>You specify templates using the <a class="ulink" href="https://mustache.github.io" target="_top">Mustache</a> scripting
language.</p><p>For example, the following snippet shows how templates enable dynamic subjects
in sent emails:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "actions" : {
    "email_notification" : {
      "email" : {
        "subject" : "{{ctx.metadata.color}} alert"
      }
    }
  }
}</pre></div><h5><a id="inline-templates-scripts"></a>Inline Templates and Scripts</h5><p>To define an inline template or script, you simply specify it directly in the
value of a field. For example, the following snippet configures the subject of
the <code class="literal">email</code> action using an inline template that references the <code class="literal">color</code> value in
the context metadata.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">"actions" : {
  "email_notification" : {
     "email" : {
       "subject" : "{{ctx.metadata.color}} alert"
     }
   }
  }
}</pre></div><p>For a script, you simply specify the inline script as the value of the <code class="literal">script</code>
field. For example:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">"condition" : {
  "script" : "return true"
}</pre></div><p>You can also explicitly specify the inline type by using a formal object
definition as the field value. For example:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">"actions" : {
  "email_notification" : {
    "email" : {
      "subject" : {
         "inline" : "{{ctx.metadata.color}} alert"
      }
    }
  }
}</pre></div><p>The formal object definition for a script would be:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">"condition" : {
  "script" : {
    "inline": "return true"
  }
}</pre></div><h5><a id="stored-templates-scripts"></a>Stored Templates and Scripts</h5><p>If you <a class="ulink" href="http://www.elastic.co/guide/en/elasticsearch/reference/master/modules-scripting-using.html#modules-scripting-stored-scripts" target="_top">store</a> your templates and
scripts, you can reference them by id.</p><p>To reference an stored script or template, you use the formal object definition
and specify its id in the <code class="literal">id</code> field. For example, the following snippet
references the <code class="literal">email_notification_subject</code> template:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  ...
  "actions" : {
    "email_notification" : {
      "email" : {
        "subject" : {
          "id" : "email_notification_subject",
          "params" : {
            "color" : "red"
          }
        }
      }
    }
  }
}</pre></div><h5><a id="file-templates-scripts"></a>File-based Templates and Scripts</h5><p>If you store templates or scripts in the <code class="literal">$ES_HOME/config/scripts</code> directory, you
can reference them by name. Template files must be saved with the extension
<code class="literal">.mustache</code>. Script files must be saved with the appropriate file extension, such
as <code class="literal">.groovy</code>.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The <code class="literal">config/scripts</code> directory is scanned periodically for changes. New
        and changed templates and scripts are reloaded and deleted templates and
        scripts are removed from the preloaded scripts cache. For more information,
        see <a class="ulink" href="http://www.elastic.co/guide/en/elasticsearch/reference/master/modules-scripting-using.html#reload-scripts" target="_top">Automatic Script Reloading</a>
        in the Elasticsearch Reference.</p></div></div><p>To reference a file-based stored or script, you use the formal object definition
and specify its name in the <code class="literal">file</code> field. For example, the following snippet
references the script file <code class="literal">threshold_hits.groovy</code>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">"condition" : {
    "script" : {
      "file" : "threshold_hits",
      "params" : {
        "threshold" : 0
      }
    }
  }</pre></div></div><div class="navfooter"><span class="prev"><a href="customizing-actions.html">
              « 
              Customizing Actions</a>
           
        </span><span class="next">
           
          <a href="administering-watcher.html">Administering Watcher
               »
            </a></span></div>
<!-- end body -->

            </section>

            <div id="rtpcontainer"
         class="col-xs-12 col-sm-4 col-md-4"><h3>Top Videos</h3><ul><li><a href="https://www.elastic.co/webinars/elasticsearch-2-0-overview?baymax=default&elektra=docs&storm=top-video">Getting Started</a></li><li><a href="http://www.elastic.co/webinars/elasticsearch-performance-optimization-tale-two-tickets/?elektra=docs">Scaling</a></li><li><a href="http://www.elastic.co/webinars/shield-securing-your-data-in-elasticsearch/?elektra=docs">Security</a></li></ul><hr/></div></div></div></section></div><script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script><div class="subscribe-wrapper"><div class="container text-left"><div class="subscribe-title"><h5>Be in the know with the latest and greatest from Elastic.</h5></div><div class="subscribe-form"><form id="mktoForm_1398" class="mktoForm sb-form"></form><div class="form_thanks hide"><p>Thanks for subscribing! We'll keep you updated with new releases.</p></div></div></div></div><footer class="footer-wrapper"><div class="container"><div class="row footer-content"><div class="col-xs-6 col-sm-3 col-md-3"><h3><a href="/products">Products</a></h3><ul><li><a href="/products/elasticsearch">Elasticsearch</a></li><li><a href="/products/kibana">Kibana</a></li><li><a href="/products/logstash">Logstash</a></li><li><a href="/products/beats">Beats</a></li><li><a href="/cloud">Elastic Cloud</a></li><li><a href="/products/shield">Shield (Security)</a></li><li><a href="/products/watcher">Watcher (Alerting)</a></li><li><a href="/products/marvel">Marvel (Monitoring)</a></li><li><a href="/products/graph">Graph</a></li><li><a href="/products/reporting">Reporting</a></li><li><a href="/products/hadoop">ES-Hadoop</a></li></ul></div><div class="col-xs-6 col-sm-3 col-md-3"><h3>Resources</h3><ul><li><a href="/blog">Blog</a></li><li><a href="/community">Community</a></li><li><a href="/use-cases">Customers & Use Cases</a></li><li><a href="/guide">Documentation</a></li><li><a href="/elasticon">Elastic{ON} Events</a></li><li><a href="https://discuss.elastic.co/">Forums</a></li><li><a href="/community/meetups">Meetups</a></li><li><a href="https://support.elastic.co">Support Portal/Login</a></li><li><a href="/videos">Videos & Webinars</a></li><li><a href="/training">Training</a></li></ul></div><div class="col-xs-6 col-sm-3 col-md-3"><h3><a href="/about">About</a></h3><ul><li><a href="/about/careers">Careers</a></li><li><a href="/contact">Contact</a></li><li><a href="/about/leadership">Leadership</a></li><li><a href="/about/partners">Partners</a></li><li><a href="/about/press">Press</a></li></ul></div><div class="col-xs-6 col-sm-3 col-md-3"><h3>Language</h3><ul><li><a href="/">English</a></li><li><a href="/fr">French</a></li><li><a href="/de">German</a></li><li><a href="/jp">Japanese</a></li><li><a href="/kr">Korean</a></li></ul></div></div><div class="row social-icon"><div class="col-xs-12 col-sm-12 col-md-12"><ul><li class="facebook"><a target="_blank" id="footer_facebook" href="http://www.facebook.com/elastic.co" target="_blank"></a></li><li class="twitter"><a target="_blank" id="footer_twitter" href="https://www.twitter.com/elastic" target="_blank"></a></li><li class="linkedin"><a target="_blank" id="footer_linkedin" href="https://www.linkedin.com/company/elastic-co" target="_blank"></a></li><li class="xing"><a target="_blank" id="footer_xing" href="https://www.xing.com/companies/elastic.co" target="_blank"></a></li><li class="youtube"><a target="_blank" id="footer_youtube" href="https://www.youtube.com/user/elasticsearch" target="_blank"></a></li></ul></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div class="copyright"><ul><li><a href="/legal/trademarks">Trademarks</a></li><li><a href="" legal="" terms-of-use"="">Terms of Use</a></li><li><a href="" legal="" privacy-policy"="">Privacy</a></li><li><a href="" legal="" privacy-and-cookie-policy"="">Cookie Policy</a></li><li><a href="/brand">Brand</a></li></ul><div class="copyright-content"><div class="footer-logo"><a href="#"><img src="/static/images/elastic-logo-H-full color.png" class="img-responsive"></a></div><div class="footer-text"><p>© 2016. All Rights Reserved - Elasticsearch</p><p>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries</p><p>Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/" target="_blank">Apache Software Foundation</a> in the United States and/or other countries.</p></div></div></div></div></div></div></footer><style type="text/css">
		
			.facebook{background:url("/assets/bltf66b1b8a624e81b2/facebook.svg") no-repeat;}		
		
			.twitter{background:url("/assets/blt0c27fbeba1f2b85b/twitter.svg") no-repeat;}		
		
			.linkedin{background:url("/assets/blt7890ae949fd3873f/linkedin.svg") no-repeat;}		
		
			.xing{background:url("/assets/blt0d0981773de2643c/xing.svg") no-repeat;}		
		
			.youtube{background:url("/assets/blt891f87ea1aa18977/youtube.svg") no-repeat;}		
		
	</style><script>
MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", 1398,function(form){
  form.onSuccess(function(form){
    $('#mktoForm_1398').css('display','none');
    $('#subscribe-newsletter header').hide();
    $('#mktoForm_1398').siblings('.form_thanks').removeClass('hide')
    dataLayer.push({'event': 'mktoFormSubmit'});
      return false;
    });
});
</script><script src="/static/js/jquery.min.js"></script><script src="/static/js/bootstrap.min.js"></script><script src="/static/js/jquery.autocomplete.js"></script><script src="/static/js/script.js"></script></section></div><script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";	
</script><script src="/static/js/jquery.cookie.js"></script><style></style><script type="text/javascript">
       $(document).ready(function(){
        $('.dropdown-btn').on('click', function(){
          myFunction();
        });
         function myFunction() {
            // document.getElementById("myDropdown").classList.toggle("show");
            $('#myDropdown').toggleClass('show');
        }

        // Close the dropdown menu if the user clicks outside of it
        $('body').on('click', function(event){
          if (!event.target.matches('.dropdown-btn')) {

            var dropdowns = $(".dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
              }
            }
          }
        });
       });
     </script>
            <script type="text/javascript" src="docs.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script type='text/javascript' src='https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js'></script>

            </body>
        