<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Preloading Fielddata
        | Elasticsearch: The Definitive Guide [1.x]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch: The Definitive Guide [1.x]" /><link rel="up" href="controlling-memory.html" title="Controlling Memory Use and Latency" /><link rel="prev" href="doc-values.html" title="Doc Values" /><link rel="next" href="_preventing_combinatorial_explosions.html" title="Preventing Combinatorial Explosions" /><meta name="DC.type" content="Docs/Elasticsearch/Definitive Guide/1.x" /><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png?change=123"><link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png?change=123"><link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png?change=123"><link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png?change=123"><link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png?change=123"><link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png?change=123"><link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png?change=123"><link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png?change=123"><link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png?change=123"><link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png?change=123"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?change=123"><link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png?change=123"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?change=123"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"><meta name="description" content=""/><meta property="og:image" content="/static/img/cluster-small.png"/><link rel="shortcut icon" href="favicon.ico" type="image/x-icon"><link rel="icon" href="favicon.ico?change=123" type="image/x-icon"><link rel="apple-touch-icon-precomposed" sizes="64x64" href="favicon_64x64_16bit.png"><link rel="apple-touch-icon-precomposed" sizes="32x32" href="favicon_32x32.png"><link rel="apple-touch-icon-precomposed" sizes="16x16" href="favicon_16x16.png"><link href="/static/css/main.css" rel="stylesheet"> <!--[if lt IE 9]><script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script><script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]--><link type="text/css" rel="stylesheet" href="/static/css/prettify.css"/><link type="text/css" rel="stylesheet" href="/static/css/guide.css"/><script type="text/javascript" src="/static/js/prettify.js"></script>
<link rel="stylesheet" type="text/css" href="styles.css" />

</head><body><script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-58RLH5');</script><header class="header-wrapper"><div class="navigation-wrapper"><div class="container"><nav class="navbar"><div class="navbar-mobile-header navbar-header mr-20 mr-xs-0"><div class="row hidden-sm hidden-md hidden-lg"><div class="col-xs-5 hidden-sm hidden-md hidden-lg"><div class="navbar-mobile-header-icon navbar-mobile-header-icon-out"><span></span><span></span><span></span></div> <a href="/learn" class="nav-title hidden-sm hidden-md hidden-lg m-l-10">Learn</a></div><div class="col-xs-2 text-center"><div class="navbar-brand" id="elastic"><h1> <a class="logo-m hidden-sm hidden-md hidden-lg" href="/"><img src="/assets/blt65c71c1236219a27/elastic-logo-mobile.svg" alt="elastic-logo-mobile"></a></h1></div></div><div class="col-xs-5 hidden-sm hidden-md hidden-lg text-right"><ul class="menu-m hidden-sm hidden-md hidden-lg"><li class=""><a class="icon-contact" href="/contact"></a></li><li id="searchbar"><a class="button icon" href="#"></a></li><li class="lang global-language"><a href="#">EN</a><ul class="language-list"><li><a href="/">English</a></li><li><a href="/fr/">français</a></li><li><a href="/de/">Deutsche</a></li><li><a href="/jp/">日本語</a></li><li><a href="/kr/">한국어</a></li></ul></li></ul></div></div><div class="navbar-brand hidden-xs" id="elastic"><h1> <a class="hidden-xs" id="elastic-logo" href="/"><img src="/assets/blt49aa5273c3bf983b/elastic-logo.svg" alt="elastic-logo"></a></h1></div></div><div class="collapse navbar-collapse mobile-inner-nav"><nav class="nav navbar-nav primary-nav-hover" id="nav"><ul><li> <a id="nav_products" class="  nav-item" href="/products">Products</a><div class="text-center quaternary-nav hidden-xs hover-nav"><div class="container"><div class="p-t-b-5"><ul class="list-inline nav-group"><li> <a href="/products/elasticsearch">Elasticsearch</a></li><li> <a href="/cloud">Elasticsearch as a Service</a></li><li> <a href="/products/logstash">Logstash</a></li><li> <a href="/products/kibana">Kibana</a></li><li> <a href="/products/beats">Beats</a></li><li> <a href="/products/watcher">Watcher</a></li><li> <a href="/products/shield">Shield</a></li><li> <a href="/products/marvel">Marvel</a></li><li> <a href="/products/graph">Graph</a></li><li> <a href="/products/reporting">Reporting</a></li><li> <a href="/products/hadoop">Hadoop</a></li></ul></div></div></div><ul class="hidden-sm hidden-md hidden-lg sub-navigation"><li><a id="nav_elasticsearch" href="/products/elasticsearch">Elasticsearch</a></li><li><a id="nav_elasticsearch as a service" href="/cloud">Elasticsearch as a Service</a></li><li><a id="nav_logstash" href="/products/logstash">Logstash</a></li><li><a id="nav_kibana" href="/products/kibana">Kibana</a></li><li><a id="nav_beats" href="/products/beats">Beats</a></li><li><a id="nav_watcher" href="/products/watcher">Watcher</a></li><li><a id="nav_shield" href="/products/shield">Shield</a></li><li><a id="nav_marvel" href="/products/marvel">Marvel</a></li><li><a id="nav_graph" href="/products/graph">Graph</a></li><li><a id="nav_reporting" href="/products/reporting">Reporting</a></li><li><a id="nav_hadoop" href="/products/hadoop">Hadoop</a></li></ul></li><li> <a id="nav_cloud" class="  nav-item" href="/cloud">Cloud</a><div class="text-center quaternary-nav hidden-xs hover-nav"><div class="container"><div class="p-t-b-5"><ul class="list-inline nav-group"><li> <a href="/cloud/subscriptions">Subscriptions</a></li><li> <a href="/cloud/pricing">Pricing</a></li><li> <a href="/cloud/support">Support</a></li></ul></div></div></div><ul class="hidden-sm hidden-md hidden-lg sub-navigation"><li><a id="nav_subscriptions" href="/cloud/subscriptions">Subscriptions</a></li><li><a id="nav_pricing" href="/cloud/pricing">Pricing</a></li><li><a id="nav_support" href="/cloud/support">Support</a></li></ul></li><li> <a id="nav_services" class="  nav-item" href="/services">Services</a></li><li> <a id="nav_customers" class="  nav-item" href="/use-cases">Customers</a></li><li> <a id="nav_learn" class="active nav-item" href="/learn">Learn</a><div class="text-center quaternary-nav hidden-xs hover-nav"><div class="container"><div class="p-t-b-5"><ul class="list-inline nav-group"><li> <a href="/community">Community</a></li><li> <a href="/guide">Docs</a></li><li> <a href="/blog">Blog</a></li><li> <a href="/videos">Videos</a></li><li> <a href="https://discuss.elastic.co/">Forums</a></li><li> <a href="/elasticon">Elastic{ON}</a></li></ul></div></div></div><ul class="hidden-sm hidden-md hidden-lg sub-navigation"><li><a id="nav_community" href="/community">Community</a></li><li><a id="nav_docs" href="/guide">Docs</a></li><li><a id="nav_blog" href="/blog">Blog</a></li><li><a id="nav_videos" href="/videos">Videos</a></li><li><a id="nav_forums" href="https://discuss.elastic.co/">Forums</a></li><li><a id="nav_elastic{on}" href="/elasticon">Elastic{ON}</a></li></ul></li></ul></nav><nav class="nav navbar-nav navbar-right hidden-xs"><ul><li class="hidden-xs hidden-sm"><a href="/downloads">Downloads</a></li><li class="hidden-xs hidden-md hidden-lg"><a class="icon-download" href="/downloads"></a></li><li class="hidden-xs hidden-sm"><a class="btn btn-primary btn-contact" href="/contact">Contact</a></li><li class="hidden-xs hidden-md hidden-lg"><a class="icon-contact" href="/contact"></a></li><li class="hidden-xs" id="searchbar"><a class="button icon" href="#"></a></li><li class="hidden-xs lang global-language"><a href="#">EN</a><ul class="language-list"><li><a class="" href="/">English</a></li><li><a class="" href="/fr/">français</a></li><li><a class="" href="/de/">Deutsche</a></li><li><a class="" href="/jp/">日本語</a></li><li><a class="" href="/kr/">한국어</a></li></ul></li></ul></nav></div></nav></div></div><div class="header-search-wrapper open-search"><div class="container"><div class="big-search"><i class="big-search-icon"></i><form id="searchfrm" name="searchForm" autocomplete="on" action="/search" method="get"><ul class="tags-wrapper"><li class="search-field"><input type="text" name="q" id="autocomplete" class="form-control global-input" autocomplete="off"></li></ul></form><a class="header-search-cancel" href="#"></a></div><div class="nav-auto-complete"></div></div></div><script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script>
$(window).load(function () {
  $(".navbar-mobile-header-icon").click(function(index){
    $('.navigation-wrapper').toggleClass('menu-overlay');
    $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
    $(".mobile-inner-nav").slideToggle(500);
    $('.mobile-inner-nav .sub-navigation').css('display','none');
    $(".mobile-inner-nav a").each(function( index ) {
      $(this).css({'animation-delay': (index/25)+'s'});
    });
  });

  if($(window).width() < 769){
    $(".nav-item").click(function(e){
      e.preventDefault();
      var parent = $(this).parent();
      $('.sub-navigation',parent).slideToggle(250);
    })
  }
});
</script></header><style> 
    
      .m-shortcuts li a.m-search {
        background: url("/assets/blt78ef101d1c58b693/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-docs {
        background: url("/assets/blt8c2d02cd42735ac3/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-contact {
        background: url("/assets/blte4c9f7f37cf09587/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
      
</style><script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script type="text/javascript" src="/static/js/nav-v5.js"></script><script type="text/javascript">
  $(document).ready( function(){
    $('.navbar-toggle').on('click', function(){
      $('.mobile-navigation, .menu-open').hide();
      $('.navigation-wrapper').addClass('mobile-navigation');
      $('.navbar').addClass('menu-open');
      $('.menu-close').show();
    });
    $('.menu-close').on('click', function(){
      $('.navigation-wrapper').removeClass('mobile-navigation');
      $('.navbar').removeClass('menu-open');
      $('.menu-close').hide();
      console.log("close");
    });

    // $(".mobile-inner-header-icon").click(function(){
    //   $(this).toggleClass("mobile-inner-header-icon-click mobile-inner-header-icon-out");
    //   $(".mobile-inner-nav").slideToggle(250);
    //   $(".navigation-wrapper").toggleClass('mobile-menu');
    //   if ($('.mobile-inner-header-icon-click').is(":visible")) {
    //     $('.menu-m').css({'display':"none"});
    //   }else{
    //     $('.menu-m').css({'display':"table-cell"});
    //   }
    // });
    // $(".mobile-inner-nav a").each(function( index ) {
    //   $( this ).css({'animation-delay': (index/10)+'s'});
    //   // $(".navigation-wrapper").removeClass('mobile-menu');
    // });
  });
</script><div class="tertiary-nav"><div class="container"><div class="p-t-b-13 bdr-btm-e7e7e7 clearfix"><div class="breadcrum-wrapper pull-left text-left"> <a href="/learn">Learn</a> <span>Docs</span></div></div></div></div><div class="nav-mobile-dropdown hidden-sm hidden-md hidden-lg clearfix"><div class="container"><div class="breadcrum-wrapper pull-left text-left"> <a class="dropdown-btn" href="javascript:void(0)">Docs</a></div></div></div><div class="main-container"><section id="content"><div class="content-wrapper">
            <div id="pageheader">
    <div class="container">
        <header>
            <h1><a href="/learn" title="Learn">Learn</a> |</h1>
            <h2><a href="/guide" title="Docs">Docs</a></h2>
        </header>
    </div>
</div>
<section id="guide">

            <!-- start body -->
<div class="page_header"><b>PLEASE NOTE:</b>
<br/>
This page is for an older version of the software. Check out the <a href="../current/index.html">latest
version&#39;s documentation here</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch: The Definitive Guide
      [1.x]
    </a></span> » <span class="breadcrumb-link"><a href="aggregations.html">Aggregations </a></span> » <span class="breadcrumb-link"><a href="controlling-memory.html">Controlling Memory Use and Latency</a></span> » <span class="breadcrumb-node">Preloading Fielddata</span></div><div class="navheader"><span class="prev"><a href="doc-values.html">
              « 
              Doc Values</a>
           
        </span><span class="next">
           
          <a href="_preventing_combinatorial_explosions.html">Preventing Combinatorial Explosions
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="preload-fielddata"></a>Preloading Fielddata<a href="https://github.com/elastic/elasticsearch-definitive-guide/edit/1.x/300_Aggregations/115_eager.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The default behavior of Elasticsearch is to <a id="id-1.7.12.7.2.1" class="indexterm"></a>
<a id="id-1.7.12.7.2.2" class="indexterm"></a>load in-memory fielddata <span class="emphasis"><em>lazily</em></span>.
The first time Elasticsearch encounters a query that needs fielddata for a
particular field, it will load that entire field into memory for each segment
in the index.</p><p>For small segments, this requires a negligible amount of time.  But if you
have a few 5 GB segments and need to load 10 GB of fielddata into memory, this
process could take tens of seconds.  Users accustomed to subsecond response
times would all of a sudden be hit by an apparently unresponsive website.</p><p>There are three methods to combat this latency spike:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Eagerly load fielddata
</li><li class="listitem">
Eagerly load global ordinals
</li><li class="listitem">
Prepopulate caches with warmers
</li></ul></div><p>All are variations on the same concept: preload the fielddata so that there is
no latency spike when the user needs to execute a search.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="eager-fielddata"></a>Eagerly Loading Fielddata<a href="https://github.com/elastic/elasticsearch-definitive-guide/edit/1.x/300_Aggregations/115_eager.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The first tool is called <span class="emphasis"><em>eager loading</em></span> (as opposed <a id="id-1.7.12.7.7.2.2" class="indexterm"></a>
<a id="id-1.7.12.7.7.2.3" class="indexterm"></a>to the default lazy
loading). As new segments are created (by refreshing, flushing, or merging),
fields with eager loading enabled will have their per-segment fielddata
preloaded <span class="emphasis"><em>before</em></span> the segment becomes visible to search.</p><p>This means that the first query to hit the segment will not need to trigger
fielddata loading, as the in-memory cache has already been populated. This
prevents your users from experiencing the <span class="emphasis"><em>cold cache</em></span> latency spike.</p><p>Eager loading is enabled on a per-field basis, so you can control which fields
are pre-loaded:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT /music/_mapping/_song
{
  "price_usd": {
    "type": "integer",
    "fielddata": {
      "loading" : "eager" <a id="CO222-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO222-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
By setting <code class="literal">fielddata.loading: eager</code>, we tell Elasticsearch to preload
this field’s contents into memory.
</p></td></tr></table></div><p>Fielddata loading can be set to <code class="literal">lazy</code> or <code class="literal">eager</code> on existing fields, using
the <code class="literal">update-mapping</code> API.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>Eager loading simply shifts the cost of loading fielddata.  Instead of paying
at query time, you pay at refresh time.</p><p>Large segments will take longer to refresh than small segments.  Usually,
large segments are created by merging smaller segments that are already
visible to search, so the slower refresh time is not important.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="global-ordinals"></a>Global Ordinals<a href="https://github.com/elastic/elasticsearch-definitive-guide/edit/1.x/300_Aggregations/115_eager.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>One of the techniques used to reduce the memory usage of string
fielddata is <a id="id-1.7.12.7.8.2.1" class="indexterm"></a>called <span class="emphasis"><em>ordinals</em></span>.</p><p>Imagine that we have a billion documents, each of which has a <code class="literal">status</code> field.
There are only three statuses: <code class="literal">status_pending</code>, <code class="literal">status_published</code>,
<code class="literal">status_deleted</code>. If we were to hold the full string status in memory for
every document, we would use 14 to 16 bytes per document, or about 15 GB.</p><p>Instead, we can identify the three unique strings, sort them, and number them: 0, 1, 2.</p><pre class="literallayout">Ordinal | Term
-------------------
0       | status_deleted
1       | status_pending
2       | status_published</pre><p>The original strings are stored only once in the ordinals list, and each
document just uses the numbered ordinal to point to the value that it
contains.</p><pre class="literallayout">Doc     | Ordinal
-------------------------
0       | 1  # pending
1       | 1  # pending
2       | 2  # published
3       | 0  # deleted</pre><p>This reduces memory usage from 15 GB to less than 1 GB!</p><p>But there is a problem. Remember that fielddata caches are <span class="emphasis"><em>per segment</em></span>.  If
one segment contains only two statuses—<code class="literal">status_deleted</code> and
<code class="literal">status_published</code>—then the resulting ordinals (0 and 1) will not be the
same as the ordinals for a segment that contains all three statuses.</p><p>If we try to run a <code class="literal">terms</code> aggregation on the <code class="literal">status</code> field, we need to
aggregate on the actual string values, which means that we need to identify
the same values across all segments.  A naive way of doing this would be to
run the aggregation on each segment, return the string values from each
segment, and then reduce them into an overall result.  While this would work,
it would be slow and CPU intensive.</p><p>Instead, we use a structure called <span class="emphasis"><em>global ordinals</em></span>. <a id="id-1.7.12.7.8.11.2" class="indexterm"></a> Global ordinals are a
small in-memory data structure built on top of fielddata.  Unique values are
identified <span class="emphasis"><em>across all segments</em></span> and stored in an ordinals list like the one
we have already described.</p><p>Now, our <code class="literal">terms</code> aggregation can just aggregate on the global ordinals, and
the conversion from ordinal to actual string value happens only once at the
end of the aggregation. This increases performance of aggregations (and
sorting) by a factor of three or four.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_building_global_ordinals"></a>Building global ordinals<a href="https://github.com/elastic/elasticsearch-definitive-guide/edit/1.x/300_Aggregations/115_eager.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Of course, nothing in life is free. <a id="id-1.7.12.7.8.13.2.1" class="indexterm"></a>
<a id="id-1.7.12.7.8.13.2.2" class="indexterm"></a> Global ordinals cross all segments in an
index, so if a new segment is added or an old segment is deleted, the global
ordinals need to be rebuilt.  Rebuilding requires reading every unique term in
every segment.  The higher the cardinality—the more unique terms that exist—the longer this process takes.</p><p>Global ordinals are built on top of in-memory fielddata and doc values.  In
fact, they are one of the major reasons that doc values perform as well as
they do.</p><p>Like fielddata loading, global ordinals are built lazily, by default.  The
first request that requires fielddata to hit an index will trigger the
building of global ordinals. Depending on the cardinality of the field, this
can result in a significant latency spike for your users.  Once global
ordinals have been rebuilt, they will be reused until the segments in the index
change: after a refresh, a flush, or a merge.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="eager-global-ordinals"></a>Eager global ordinals<a href="https://github.com/elastic/elasticsearch-definitive-guide/edit/1.x/300_Aggregations/115_eager.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Individual string fields<a id="id-1.7.12.7.8.14.2.1" class="indexterm"></a>
<a id="id-1.7.12.7.8.14.2.2" class="indexterm"></a><a id="id-1.7.12.7.8.14.2.3" class="indexterm"></a>
<a id="id-1.7.12.7.8.14.2.4" class="indexterm"></a> can be configured to prebuild global ordinals eagerly:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT /music/_mapping/_song
{
  "song_title": {
    "type": "string",
    "fielddata": {
      "loading" : "eager_global_ordinals" <a id="CO223-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO223-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Setting <code class="literal">eager_global_ordinals</code> also implies loading fielddata eagerly.
</p></td></tr></table></div><p>Just like the eager preloading of fielddata, eager global ordinals are built
before a new segment becomes visible to search.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Ordinals are only built and used for strings.  Numerical data (integers, geopoints,
dates, etc) doesn’t need an ordinal mapping, since the value itself acts as an
intrinsic ordinal mapping.</p><p>Therefore, you can only enable eager global ordinals for string fields.</p></div></div><p>Doc values can also have their global ordinals built eagerly:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT /music/_mapping/_song
{
  "song_title": {
    "type":       "string",
    "doc_values": true,
    "fielddata": {
      "loading" : "eager_global_ordinals" <a id="CO224-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO224-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
In this case, fielddata is not loaded into memory, but doc values are
    loaded into the filesystem cache.
</p></td></tr></table></div><p>Unlike fielddata preloading, eager building of global ordinals can have an
impact on the <span class="emphasis"><em>real-time</em></span> aspect of your data.  For very high cardinality
fields, building global ordinals can delay a refresh by several seconds.  The
choice is between paying the cost on each refresh, or on the first query after
a refresh.  If you index often and query seldom, it is probably better to pay
the price at query time instead of on every refresh.</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>Make your global ordinals pay for themselves. If you have very high
cardinality fields that take seconds to rebuild, increase the
<code class="literal">refresh_interval</code> so that global ordinals remain valid for longer.  This will
also reduce CPU usage, as you will need to rebuild global ordinals less often.</p></div></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="index-warmers"></a>Index Warmers<a href="https://github.com/elastic/elasticsearch-definitive-guide/edit/1.x/300_Aggregations/115_eager.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Finally, we come to <span class="emphasis"><em>index warmers</em></span>.  Warmers<a id="id-1.7.12.7.9.2.2" class="indexterm"></a> predate eager fielddata loading
and eager global ordinals, but they still serve a purpose. An index warmer
allows you to specify a query and aggregations that should be run before a new
segment is made visible to search. The idea is to prepopulate, or <span class="emphasis"><em>warm</em></span>,
caches so your users never see a spike in latency.</p><p>Originally, the most important use for warmers was to make sure that fielddata
was pre-loaded, as this is usually the most costly step.  This is now better
controlled with the techniques we discussed previously.  However, warmers can
be used to prebuild filter caches, and can still be used to preload fielddata
should you so choose.</p><p>Let’s register a warmer and then talk about what’s happening:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT /music/_warmer/warmer_1 <a id="CO225-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
{
  "query" : {
    "filtered" : {
      "filter" : {
        "bool": {
          "should": [ <a id="CO225-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
            { "term": { "tag": "rock"        }},
            { "term": { "tag": "hiphop"      }},
            { "term": { "tag": "electronics" }}
          ]
        }
      }
    }
  },
  "aggs" : {
    "price" : {
      "histogram" : {
        "field" : "price", <a id="CO225-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        "interval" : 10
      }
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO225-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Warmers are associated with an index (<code class="literal">music</code>) and are registered using
the <code class="literal">_warmer</code> endpoint and a unique ID (<code class="literal">warmer_1</code>).
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO225-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The three most popular music genres have their filter caches prebuilt.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO225-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The fielddata and global ordinals for the <code class="literal">price</code> field will be preloaded.
</p></td></tr></table></div><p>Warmers are registered against a specific index.<a id="id-1.7.12.7.9.7.1" class="indexterm"></a>  Each warmer is given a
unique ID, because you can have multiple warmers per index.</p><p>Then you just specify a query, any query.  It can include queries, filters,
aggregations, sort values, scripts—literally any valid query DSL.  The
point is to register queries that are representative of the traffic that your
users will generate, so that appropriate caches can be prepopulated.</p><p>When a new segment is created, Elasticsearch will <span class="emphasis"><em>literally</em></span> execute the queries
registered in your warmers.  The act of executing these queries will force
caches to be loaded.  Only after all warmers have been executed will the segment
be made visible to search.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>Similar to eager loading, warmers shift the cost of cold caches to refresh time.
When registering warmers, it is important to be judicious.  You <span class="emphasis"><em>could</em></span> add
thousands of warmers to make sure every cache is populated—but that will
drastically increase the time it takes for new segments to be made searchable.</p><p>In practice, select a handful of queries that represent the majority of your
user’s queries and register those.</p></div></div><p>Some administrative details (such as getting existing warmers and deleting warmers) that have been omitted from this explanation.  Refer to the <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-warmers.html" target="_top">warmers documentation</a> for the rest
of the details.</p></div></div><div class="navfooter"><span class="prev"><a href="doc-values.html">
              « 
              Doc Values</a>
           
        </span><span class="next">
           
          <a href="_preventing_combinatorial_explosions.html">Preventing Combinatorial Explosions
               »
            </a></span></div>
<!-- end body -->

            </section>

            <div id="rtpcontainer"
         class="col-xs-12 col-sm-4 col-md-4"><h3>Top Videos</h3><ul><li><a href="https://www.elastic.co/webinars/elasticsearch-2-0-overview?baymax=default&elektra=docs&storm=top-video">Getting Started</a></li><li><a href="http://www.elastic.co/webinars/elasticsearch-performance-optimization-tale-two-tickets/?elektra=docs">Scaling</a></li><li><a href="http://www.elastic.co/webinars/shield-securing-your-data-in-elasticsearch/?elektra=docs">Security</a></li></ul><hr/></div></div></div></section></div><script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script><div class="subscribe-wrapper"><div class="container text-left"><div class="subscribe-title"><h5>Be in the know with the latest and greatest from Elastic.</h5></div><div class="subscribe-form"><form id="mktoForm_1398" class="mktoForm sb-form"></form><div class="form_thanks hide"><p>Thanks for subscribing! We'll keep you updated with new releases.</p></div></div></div></div><footer class="footer-wrapper"><div class="container"><div class="row footer-content"><div class="col-xs-6 col-sm-3 col-md-3"><h3><a href="/products">Products</a></h3><ul><li><a href="/products/elasticsearch">Elasticsearch</a></li><li><a href="/products/kibana">Kibana</a></li><li><a href="/products/logstash">Logstash</a></li><li><a href="/products/beats">Beats</a></li><li><a href="/cloud">Elastic Cloud</a></li><li><a href="/products/shield">Shield (Security)</a></li><li><a href="/products/watcher">Watcher (Alerting)</a></li><li><a href="/products/marvel">Marvel (Monitoring)</a></li><li><a href="/products/graph">Graph</a></li><li><a href="/products/reporting">Reporting</a></li><li><a href="/products/hadoop">ES-Hadoop</a></li></ul></div><div class="col-xs-6 col-sm-3 col-md-3"><h3>Resources</h3><ul><li><a href="/blog">Blog</a></li><li><a href="/community">Community</a></li><li><a href="/use-cases">Customers & Use Cases</a></li><li><a href="/guide">Documentation</a></li><li><a href="/elasticon">Elastic{ON} Events</a></li><li><a href="https://discuss.elastic.co/">Forums</a></li><li><a href="/community/meetups">Meetups</a></li><li><a href="https://support.elastic.co">Support Portal/Login</a></li><li><a href="/videos">Videos & Webinars</a></li><li><a href="/training">Training</a></li></ul></div><div class="col-xs-6 col-sm-3 col-md-3"><h3><a href="/about">About</a></h3><ul><li><a href="/about/careers">Careers</a></li><li><a href="/contact">Contact</a></li><li><a href="/about/leadership">Leadership</a></li><li><a href="/about/partners">Partners</a></li><li><a href="/about/press">Press</a></li></ul></div><div class="col-xs-6 col-sm-3 col-md-3"><h3>Language</h3><ul><li><a href="/">English</a></li><li><a href="/fr">French</a></li><li><a href="/de">German</a></li><li><a href="/jp">Japanese</a></li><li><a href="/kr">Korean</a></li></ul></div></div><div class="row social-icon"><div class="col-xs-12 col-sm-12 col-md-12"><ul><li class="facebook"><a target="_blank" id="footer_facebook" href="http://www.facebook.com/elastic.co" target="_blank"></a></li><li class="twitter"><a target="_blank" id="footer_twitter" href="https://www.twitter.com/elastic" target="_blank"></a></li><li class="linkedin"><a target="_blank" id="footer_linkedin" href="https://www.linkedin.com/company/elastic-co" target="_blank"></a></li><li class="xing"><a target="_blank" id="footer_xing" href="https://www.xing.com/companies/elastic.co" target="_blank"></a></li><li class="youtube"><a target="_blank" id="footer_youtube" href="https://www.youtube.com/user/elasticsearch" target="_blank"></a></li></ul></div></div><div class="row"><div class="col-xs-12 col-sm-12 col-md-12"><div class="copyright"><ul><li><a href="/legal/trademarks">Trademarks</a></li><li><a href="" legal="" terms-of-use"="">Terms of Use</a></li><li><a href="" legal="" privacy-policy"="">Privacy</a></li><li><a href="" legal="" privacy-and-cookie-policy"="">Cookie Policy</a></li><li><a href="/brand">Brand</a></li></ul><div class="copyright-content"><div class="footer-logo"><a href="#"><img src="/static/images/elastic-logo-H-full color.png" class="img-responsive"></a></div><div class="footer-text"><p>© 2016. All Rights Reserved - Elasticsearch</p><p>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries</p><p>Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/" target="_blank">Apache Software Foundation</a> in the United States and/or other countries.</p></div></div></div></div></div></div></footer><style type="text/css">
		
			.facebook{background:url("/assets/bltf66b1b8a624e81b2/facebook.svg") no-repeat;}		
		
			.twitter{background:url("/assets/blt0c27fbeba1f2b85b/twitter.svg") no-repeat;}		
		
			.linkedin{background:url("/assets/blt7890ae949fd3873f/linkedin.svg") no-repeat;}		
		
			.xing{background:url("/assets/blt0d0981773de2643c/xing.svg") no-repeat;}		
		
			.youtube{background:url("/assets/blt891f87ea1aa18977/youtube.svg") no-repeat;}		
		
	</style><script>
MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", 1398,function(form){
  form.onSuccess(function(form){
    $('#mktoForm_1398').css('display','none');
    $('#subscribe-newsletter header').hide();
    $('#mktoForm_1398').siblings('.form_thanks').removeClass('hide')
    dataLayer.push({'event': 'mktoFormSubmit'});
      return false;
    });
});
</script><script src="/static/js/jquery.min.js"></script><script src="/static/js/bootstrap.min.js"></script><script src="/static/js/jquery.autocomplete.js"></script><script src="/static/js/script.js"></script></section></div><script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";	
</script><script src="/static/js/jquery.cookie.js"></script><style></style><script type="text/javascript">
       $(document).ready(function(){
        $('.dropdown-btn').on('click', function(){
          myFunction();
        });
         function myFunction() {
            // document.getElementById("myDropdown").classList.toggle("show");
            $('#myDropdown').toggleClass('show');
        }

        // Close the dropdown menu if the user clicks outside of it
        $('body').on('click', function(event){
          if (!event.target.matches('.dropdown-btn')) {

            var dropdowns = $(".dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
              }
            }
          }
        });
       });
     </script>
            <script type="text/javascript" src="docs.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script type='text/javascript' src='https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js'></script>

            </body>
        